/**
 * Chatooly CDN - Core Library (POC Version) - Built from Modules
 * Provides PNG export functionality for canvas-based design tools
 * Supports p5.js, Three.js, and DOM-based tools
 * 
 * Built: 2025-08-10T18:25:17.774Z
 * Architecture: Modular components combined into single file
 */
!function(){"use strict";window.Chatooly={version:"1.0.0-poc",config:{},init:function(t){this.config=Object.assign({name:"Untitled Tool",exportFormats:["png"],resolution:2,buttonPosition:"bottom-right"},t),this.ui.createExportButton(),this.utils.logDevelopmentMode()},export:function(t,e){if(e=e||{},"png"!==(t=t||"png"))return void console.warn("Chatooly POC: Only PNG export supported in this version");const o=this.utils.detectExportTarget();this.pngExport.export(o,e)}},
/**
     * Chatooly CDN - Utilities Module
     * Contains utility functions for target detection, environment checks, and helpers
     */
Chatooly.utils={detectExportTarget:function(){
// 1. Look for Chatooly export container first (highest priority for HTML tools)
const t=document.querySelector("#chatooly-canvas");if(t){const e=t.querySelector("canvas");return e&&(this._isP5Canvas(e)||this._isThreeCanvas(e))?{type:"canvas",element:e}:{type:"dom",element:t}}const e=document.querySelectorAll("canvas");if(e.length>0){let t=e[0];for(let o=1;o<e.length;o++){const n=e[o];n.width*n.height>t.width*t.height&&(t=n)}return{type:"canvas",element:t}}const o=["#app","#canvas-container","main"];for(const t of o){const e=document.querySelector(t);if(e)return{type:"dom",element:e}}return{type:"dom",element:document.body}},isDevelopment:function(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname||"file:"===location.protocol},generateFilename:function(t,e){return`${t.name.toLowerCase().replace(/[^a-z0-9]/g,"-")}-export-${(new Date).toISOString().slice(0,10)}.${e||"png"}`},downloadImage:function(t,e){const o=document.createElement("a");o.download=e,o.href=t,document.body.appendChild(o),o.click(),document.body.removeChild(o)},canRerenderAtHighRes:function(t){return window.p5||window.THREE||"defaultCanvas0"===t.id},logDevelopmentMode:function(){this.isDevelopment()&&console.log("Chatooly: Development mode detected - publish functionality enabled")},_isP5Canvas:function(t){return window.p5&&("defaultCanvas0"===t.id||window.pixelDensity)},_isThreeCanvas:function(t){return window.THREE&&(window.renderer||window.threeRenderer)}},
/**
     * Chatooly CDN - HTML5 Canvas Export Module
     * Handles multiple export formats for standard HTML5 canvas elements
     */
Chatooly.canvasExporters||(Chatooly.canvasExporters={}),Chatooly.canvasExporters.html5={png:{export:function(t,e){const o=e.resolution||Chatooly.config.resolution||2,n=e.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");try{let e;if(o>1)if(window.renderHighResolution&&"function"==typeof window.renderHighResolution){const n=document.createElement("canvas");n.width=t.width*o,n.height=t.height*o,window.renderHighResolution(n,o),e=n.toDataURL("image/png")}else if(window.Chatooly&&window.Chatooly.renderHighRes&&"function"==typeof window.Chatooly.renderHighRes){
// Use Chatooly API for high-res rendering
const n=document.createElement("canvas");n.width=t.width*o,n.height=t.height*o,
// Call the Chatooly high-res render function
window.Chatooly.renderHighRes(n,o),e=n.toDataURL("image/png"),console.log("Chatooly: High-resolution export using Chatooly.renderHighRes API.")}else{const n=document.createElement("canvas"),i=n.getContext("2d");n.width=t.width*o,n.height=t.height*o,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(t,0,0,n.width,n.height),e=n.toDataURL("image/png"),console.warn("Chatooly: Using upscaling for export. For true high-resolution, implement window.renderHighResolution() or window.Chatooly.renderHighRes()")}else e=t.toDataURL("image/png");Chatooly.utils.downloadImage(e,n),console.log("Chatooly: HTML5 Canvas PNG exported at "+o+"x resolution")}catch(t){console.error("Chatooly: HTML5 Canvas PNG export failed:",t),alert("PNG export failed. This might be due to CORS restrictions.")}}},jpeg:{export:function(t,e){console.warn("JPEG export not yet implemented for HTML5 canvas")}},webm:{export:function(t,e){console.warn("WebM video export not yet implemented for HTML5 canvas")}},gif:{export:function(t,e){console.warn("GIF export not yet implemented for HTML5 canvas")}}},
/**
     * Chatooly CDN - p5.js Canvas Export Module
     * Handles multiple export formats for p5.js canvas elements
     */
Chatooly.canvasExporters||(Chatooly.canvasExporters={}),Chatooly.canvasExporters.p5={png:{export:function(t,e){const o=e.resolution||Chatooly.config.resolution||2,n=e.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");try{let e;if(o>1&&window.p5&&window.pixelDensity){const n=window.pixelDensity();window.pixelDensity(o),window.redraw(),e=t.toDataURL("image/png"),window.pixelDensity(n)}else e=t.toDataURL("image/png");Chatooly.utils.downloadImage(e,n),console.log("Chatooly: p5.js Canvas PNG exported at "+o+"x resolution")}catch(t){console.error("Chatooly: p5.js Canvas PNG export failed:",t),alert("PNG export failed. This might be due to CORS restrictions.")}}},webm:{export:function(t,e){console.warn("WebM video export not yet implemented for p5.js canvas")}},gif:{export:function(t,e){console.warn("GIF export not yet implemented for p5.js canvas")}},frames:{export:function(t,e){console.warn("Frame sequence export not yet implemented for p5.js canvas")}}},
/**
     * Chatooly CDN - Three.js Canvas Export Module
     * Handles multiple export formats for Three.js canvas elements
     */
Chatooly.canvasExporters||(Chatooly.canvasExporters={}),Chatooly.canvasExporters.three={png:{export:function(t,e){const o=e.resolution||Chatooly.config.resolution||2,n=e.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");try{let e;e=o>1&&window.THREE&&(window.renderer||window.threeRenderer)?this._renderHighRes(t,o):t.toDataURL("image/png"),Chatooly.utils.downloadImage(e,n),console.log("Chatooly: Three.js Canvas PNG exported at "+o+"x resolution")}catch(t){console.error("Chatooly: Three.js Canvas PNG export failed:",t),alert("PNG export failed. This might be due to CORS restrictions.")}},_renderHighRes:function(t,e){const o=window.renderer||window.threeRenderer,n=window.scene||window.threeScene,i=window.camera||window.threeCamera;if(o&&n&&i){const t=o.getSize(new THREE.Vector2),a=document.createElement("canvas"),r=new THREE.WebGLRenderer({canvas:a,antialias:!0,preserveDrawingBuffer:!0});r.setSize(t.x*e,t.y*e,!1),r.setClearColor(o.getClearColor(),o.getClearAlpha()),r.render(n,i);const s=a.toDataURL("image/png");return r.dispose(),s}return this._fallbackScale(t,e)},_fallbackScale:function(t,e){const o=document.createElement("canvas"),n=o.getContext("2d");return o.width=t.width*e,o.height=t.height*e,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(t,0,0,o.width,o.height),o.toDataURL("image/png")}},panorama:{export:function(t,e){console.warn("360Â° panorama export not yet implemented for Three.js canvas")}},webm:{export:function(t,e){console.warn("WebM video export not yet implemented for Three.js canvas")}},glb:{export:function(t,e){console.warn("GLB model export not yet implemented for Three.js")}}},
/**
     * Chatooly CDN - DOM Export Module
     * Handles multiple export formats for DOM elements using html2canvas
     */
Chatooly.domExport={export:function(t,e){const o=e.format||"png";this[o]?this[o].export(t,e):console.warn(`Chatooly: DOM export format '${o}' not supported`)},png:{export:function(t,e){const o=e.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");"undefined"==typeof html2canvas?Chatooly.domExport._loadHtml2Canvas().then(()=>{Chatooly.domExport.png._captureDOM(t,o,e)}).catch(t=>{console.error("Chatooly: Failed to load html2canvas:",t),alert("PNG export failed: Could not load required library")}):this._captureDOM(t,o,e)},_captureDOM:function(t,e,o){const n=o.resolution||Chatooly.config.resolution||2;html2canvas(t,{scale:n,useCORS:!0,allowTaint:!1,backgroundColor:o.backgroundColor||null,width:o.width,height:o.height,scrollX:0,scrollY:0}).then(t=>{const o=t.toDataURL("image/png");Chatooly.utils.downloadImage(o,e),console.log("Chatooly: DOM PNG exported successfully at "+n+"x resolution")}).catch(t=>{console.error("Chatooly: DOM PNG export failed:",t),alert("PNG export failed. Try exporting a specific element.")})}},jpeg:{export:function(t,e){console.warn("JPEG export not yet implemented for DOM elements")}},pdf:{export:function(t,e){console.warn("PDF export not yet implemented for DOM elements")}},svg:{export:function(t,e){console.warn("SVG export not yet implemented for DOM elements")}},_loadHtml2Canvas:function(){return this._html2canvasPromise||(this._html2canvasPromise=new Promise((t,e)=>{const o=["https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js","https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js","https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"],n=i=>{if(i>=o.length)return void e(new Error("All CDN sources failed"));const a=document.createElement("script");a.src=o[i],a.async=!0,a.crossOrigin="anonymous";const r=()=>{document.head.removeChild(a)};a.onload=()=>{r(),t()},a.onerror=()=>{r(),console.warn(`Chatooly: Failed to load html2canvas from ${o[i]}`),n(i+1)},setTimeout(()=>{window.html2canvas||(r(),n(i+1))},1e4),document.head.appendChild(a)};n(0)})),this._html2canvasPromise}},
/**
     * Chatooly CDN - PNG Export Module
     * Main PNG export orchestrator that delegates to specific export handlers
     */
Chatooly.pngExport={export:function(t,e){"canvas"===t.type?this._exportCanvas(t.element,e):this._exportDOM(t.element,e)},_exportCanvas:function(t,e){this._isP5Canvas(t)?Chatooly.canvasExporters.p5.png.export(t,e):this._isThreeCanvas(t)?Chatooly.canvasExporters.three.png.export(t,e):Chatooly.canvasExporters.html5.png.export(t,e)},_exportDOM:function(t,e){Chatooly.domExport.export(t,e)},_isP5Canvas:function(t){return window.p5&&("defaultCanvas0"===t.id||window.pixelDensity)},_isThreeCanvas:function(t){return window.THREE&&(window.renderer||window.threeRenderer)}},
/**
     * Chatooly CDN - Publishing Module
     * Handles tool publishing functionality for development mode
     */
Chatooly.publish={publish:async function(t){if(!Chatooly.utils.isDevelopment())return void console.warn("Chatooly: Publishing only available in development mode");const e=(t=t||{}).name||Chatooly.config.name||prompt("Enter tool name for publishing:");if(!e)return void console.log("Chatooly: Publishing cancelled");const o=this._loadToolConfig(t),n=this._createToolSlug(e);console.log('Chatooly: Publishing tool "'+e+'" as "'+n+'"');const i=this.validateTool();if(!i.valid)return console.error("Chatooly: Tool validation failed:",i.errors),void alert("Publishing failed. Please fix these errors:\n"+i.errors.join("\n"));i.warnings.length>0&&console.warn("Chatooly: Publishing warnings:",i.warnings),this._showPublishingProgress();try{const t=await this._gatherToolFiles(),i={name:e,slug:n,category:o.category||"generators",tags:o.tags||[],description:o.description||"",private:o.private||!1,version:o.version||"1.0.0",author:o.author||"Anonymous",timestamp:(new Date).toISOString()},a=await this._uploadToStaging(n,t,i);this._hidePublishingProgress(),this._showPublishSuccess(a)}catch(t){this._hidePublishingProgress(),this._showPublishError(t)}},_createToolSlug:function(t){return t.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")},_gatherToolFiles:async function(){const t={},e=new Set,o=document.documentElement.cloneNode(!0),n=o.querySelector("#chatooly-export-btn");n&&n.remove();const i=o.querySelector("#chatooly-publish-progress");i&&i.remove();const a=o.querySelector('div[style*="Published Successfully"]');a&&a.remove();const r=o.querySelector('div[style*="Publishing Failed"]');r&&r.remove();
// Keep Chatooly CDN script for export functionality, but ensure it's the production version
const s=o.querySelector('script[src*="chatooly-cdn"]');if(s)s.setAttribute("src","https://yaelren.github.io/chatooly-cdn/js/core.min.js");else{const t=o.createElement("script");t.src="https://yaelren.github.io/chatooly-cdn/js/core.min.js",t.async=!0,o.head.appendChild(t)}const l="<!DOCTYPE html>"+o.outerHTML;t["index.html"]=l,e.add("index.html"),await this._collectExternalFiles(l,t,e),await this._scanFileDependencies(l,t,e);const c=Array.from(document.querySelectorAll("style:not(#chatooly-button-styles)")).map(t=>t.textContent).join("\n");c&&(t["style.css"]=c,e.add("style.css"),await this._scanFileDependencies(c,t,e,"css"));const d=Array.from(document.querySelectorAll("script:not([src]):not([id])")).map(t=>t.textContent).join("\n");return d&&(t["tool.js"]=d,e.add("tool.js"),await this._scanFileDependencies(d,t,e,"js")),console.log("Chatooly: Collected files:",Object.keys(t)),t},_collectExternalFiles:async function(t,e,o){const n=[...Array.from(document.querySelectorAll('script[src]:not([src*="http"]):not([src*="chatooly-cdn"])')).map(t=>t.getAttribute("src")),...Array.from(document.querySelectorAll('link[rel="stylesheet"][href]:not([href*="http"])')).map(t=>t.getAttribute("href"))];console.log("Chatooly: Found external files to collect:",n);for(const t of n)if(t&&!o.has(t)){o.add(t);try{const n=await this._fetchLocalFile(t);if(n){e[t]=n,console.log(`Chatooly: Collected ${t} (${n.length} chars)`);const i=t.split(".").pop().toLowerCase();["html","css","js"].includes(i)&&await this._scanFileDependencies(n,e,o,i)}}catch(e){console.warn(`Chatooly: Could not collect ${t}:`,e)}}},_scanFileDependencies:async function(t,e,o,n="html"){const i={html:[/<script src="\.\/([^"]+)"/g,/<link href="\.\/([^"]+)"/g,/<img src="\.\/([^"]+)"/g,/<source src="\.\/([^"]+)"/g,/<video src="\.\/([^"]+)"/g,/<audio src="\.\/([^"]+)"/g],css:[/url\(['"]?\.\/([^'")\s]+)['"]?\)/g,/@import ['"]\.\/([^'"]+)['"]/g],js:[/fetch\(['"`]\.\/([^'"`]+)['"`]\)/g,/import.*from ['"`]\.\/([^'"`]+)['"`]/g,/require\(['"`]\.\/([^'"`]+)['"`]\)/g,/loadJSON\(['"`]\.\/([^'"`]+)['"`]\)/g,/loadImage\(['"`]\.\/([^'"`]+)['"`]\)/g,/loadSound\(['"`]\.\/([^'"`]+)['"`]\)/g]}[n]||[];for(const n of i){let i;for(;null!==(i=n.exec(t));){const t=i[1];if(!o.has(t)){o.add(t);try{const n=await this._fetchLocalFile(t);if(n){e[t]=n;const i=t.split(".").pop().toLowerCase();["html","css","js"].includes(i)&&await this._scanFileDependencies(n,e,o,i)}}catch(e){console.warn(`Chatooly: Could not load dependency: ${t}`,e)}}}}},_fetchLocalFile:async function(t){try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=e.headers.get("content-type")||"";if(o.startsWith("image/")||o.startsWith("audio/")||o.startsWith("video/")){const t=await e.arrayBuffer(),n=new Uint8Array(t);let i="";return n.forEach(t=>i+=String.fromCharCode(t)),`data:${o};base64,${btoa(i)}`}return await e.text()}catch(e){return console.warn(`Chatooly: Failed to fetch ${t}:`,e),null}},_gatherResourceReferences:function(){const t={scripts:[],styles:[],images:[],fonts:[]};return Array.from(document.querySelectorAll("script[src]")).forEach(e=>{t.scripts.push(e.src)}),Array.from(document.querySelectorAll('link[rel="stylesheet"]')).forEach(e=>{t.styles.push(e.href)}),Array.from(document.querySelectorAll("img[src]")).forEach(e=>{t.images.push(e.src)}),t},_loadToolConfig:function(t){
// Try to load from global ChatoolyConfig or passed options
const e=window.ChatoolyConfig||{};return Object.assign({category:"tools",tags:[],description:"",private:!1,version:"1.0.0",author:"Anonymous"},e,t)},
// Upload tool to Chatooly Hub
_uploadToStaging:async function(t,e,o){try{console.log("Chatooly: Uploading to Chatooly Hub...");
// Prepare payload for Chatooly Hub API
const n={toolName:t,metadata:o,files:e},i=await fetch("https://studiovideotoolhub.vercel.app/api/publish",{method:"POST",headers:{"Content-Type":"application/json","X-Chatooly-Source":"cdn"},body:JSON.stringify(n)});
// Send to Chatooly Hub API
if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const a=await i.json();if(!a.success)throw new Error(a.message||"Publishing failed");return a}catch(e){console.warn("Chatooly: Hub API unavailable, using local simulation:",e);const n={success:!0,url:`https://tools.chatooly.com/${t}`,actualName:t,requestedName:o.name,publishedAt:(new Date).toISOString(),metadata:o,message:"Tool published successfully! (Simulated - Hub not available)"};return localStorage.setItem(`chatooly-published-${t}`,JSON.stringify(n)),n}},_showPublishingProgress:function(){const t=document.createElement("div");t.id="chatooly-publish-progress",t.innerHTML='\n                    <div style="\n                        position: fixed;\n                        top: 50%;\n                        left: 50%;\n                        transform: translate(-50%, -50%);\n                        background: white;\n                        padding: 30px;\n                        border-radius: 12px;\n                        box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n                        z-index: 100000;\n                        text-align: center;\n                        font-family: -apple-system, system-ui, sans-serif;\n                    ">\n                        <div style="\n                            width: 50px;\n                            height: 50px;\n                            border: 3px solid #f3f3f3;\n                            border-top: 3px solid #007bff;\n                            border-radius: 50%;\n                            margin: 0 auto 20px;\n                            animation: chatooly-spin 1s linear infinite;\n                        "></div>\n                        <h3 style="margin: 0 0 10px;">Publishing to Chatooly...</h3>\n                        <p style="margin: 0; color: #666;">Uploading tool files to staging server</p>\n                    </div>\n                    <style>\n                        @keyframes chatooly-spin {\n                            0% { transform: rotate(0deg); }\n                            100% { transform: rotate(360deg); }\n                        }\n                    </style>\n                ',document.body.appendChild(t)},_hidePublishingProgress:function(){const t=document.getElementById("chatooly-publish-progress");t&&t.remove()},_showPublishSuccess:function(t){const e=document.createElement("div"),o=t.actualName!==t.requestedName?`<p style="margin: 10px 0; color: #666;">Tool published as "${t.actualName}" (name was adjusted)</p>`:"";e.innerHTML=`\n                    <div style="\n                        position: fixed;\n                        top: 50%;\n                        left: 50%;\n                        transform: translate(-50%, -50%);\n                        background: white;\n                        padding: 30px;\n                        border-radius: 12px;\n                        box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n                        z-index: 100000;\n                        text-align: center;\n                        font-family: -apple-system, system-ui, sans-serif;\n                        max-width: 500px;\n                    ">\n                        <div style="\n                            width: 60px;\n                            height: 60px;\n                            background: #28a745;\n                            border-radius: 50%;\n                            margin: 0 auto 20px;\n                            display: flex;\n                            align-items: center;\n                            justify-content: center;\n                            color: white;\n                            font-size: 30px;\n                        ">âœ“</div>\n                        <h3 style="margin: 0 0 10px; color: #28a745;">Published Successfully!</h3>\n                        <p style="margin: 10px 0; color: #666;">\n                            ${t.message||"Your tool has been published to Chatooly."}\n                        </p>\n                        ${o}\n                        <div style="\n                            background: #f8f9fa;\n                            padding: 15px;\n                            border-radius: 8px;\n                            margin: 20px 0;\n                            text-align: left;\n                        ">\n                            <p style="margin: 5px 0;"><strong>Live URL:</strong><br>\n                                <a href="${t.url}" target="_blank" style="color: #007bff;">\n                                    ${t.url}\n                                </a>\n                            </p>\n                            <p style="margin: 5px 0; font-size: 12px; color: #888;">\n                                Published: ${new Date(t.publishedAt).toLocaleString()}\n                            </p>\n                        </div>\n                        <button onclick="this.closest('div').parentElement.remove()" style="\n                            background: #007bff;\n                            color: white;\n                            border: none;\n                            padding: 10px 30px;\n                            border-radius: 6px;\n                            font-size: 16px;\n                            cursor: pointer;\n                        ">Close</button>\n                    </div>\n                `,document.body.appendChild(e)},_showPublishError:function(t){const e=document.createElement("div");e.innerHTML=`\n                    <div style="\n                        position: fixed;\n                        top: 50%;\n                        left: 50%;\n                        transform: translate(-50%, -50%);\n                        background: white;\n                        padding: 30px;\n                        border-radius: 12px;\n                        box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n                        z-index: 100000;\n                        text-align: center;\n                        font-family: -apple-system, system-ui, sans-serif;\n                        max-width: 500px;\n                    ">\n                        <div style="\n                            width: 60px;\n                            height: 60px;\n                            background: #dc3545;\n                            border-radius: 50%;\n                            margin: 0 auto 20px;\n                            display: flex;\n                            align-items: center;\n                            justify-content: center;\n                            color: white;\n                            font-size: 30px;\n                        ">âœ•</div>\n                        <h3 style="margin: 0 0 10px; color: #dc3545;">Publishing Failed</h3>\n                        <p style="margin: 10px 0; color: #666;">\n                            ${t.message||"An error occurred while publishing your tool."}\n                        </p>\n                        <button onclick="this.closest('div').parentElement.remove()" style="\n                            background: #dc3545;\n                            color: white;\n                            border: none;\n                            padding: 10px 30px;\n                            border-radius: 6px;\n                            font-size: 16px;\n                            cursor: pointer;\n                        ">Close</button>\n                    </div>\n                `,document.body.appendChild(e)},validateTool:function(){const t={valid:!0,warnings:[],errors:[]};Chatooly.config.name&&"Untitled Tool"!==Chatooly.config.name||t.warnings.push("Tool name not set - using default");Chatooly.utils.detectExportTarget().element||(t.errors.push("No exportable content found"),t.valid=!1);return 0===document.querySelectorAll("script[src]").length&&t.warnings.push("No external libraries detected"),t},publishFromCLI:function(t){try{const t=window.ChatoolyPublishConfig||{name:Chatooly.config.name,category:"tools",tags:[],description:"",version:"1.0.0"};if(!t.name)throw new Error("Tool name is required in config");this.publish(t)}catch(t){console.error("Chatooly CLI: Publishing failed:",t),"undefined"!=typeof process&&process.exit&&process.exit(1)}},_getAuthToken:function(){return"poc-auth-token"}},
/**
     * Chatooly CDN - UI Module
     * Handles user interface components like export button and menus
     */
Chatooly.ui={createExportButton:function(){const t=document.getElementById("chatooly-export-btn");t&&t.remove();const e=document.createElement("div");e.id="chatooly-export-btn",e.innerHTML=this._getButtonHTML(),e.style.cssText=this._getButtonStyles(),this._injectButtonCSS(),this._attachButtonEvents(e),document.body.appendChild(e)},_getButtonHTML:function(){return`\n                    <div class="chatooly-btn-main">ðŸ“¥</div>\n                    <div class="chatooly-btn-menu" style="display: none;">\n                        <button onclick="Chatooly.export('png', {resolution: 1})">1x PNG</button>\n                        <button onclick="Chatooly.export('png', {resolution: 2})">2x PNG</button>\n                        <button onclick="Chatooly.export('png', {resolution: 4})">4x PNG</button>\n                        ${Chatooly.utils.isDevelopment()?'<button onclick="Chatooly.publish.publish()">ðŸ“¤ Publish</button>':""}\n                    </div>\n                `},_getButtonStyles:function(){return{"bottom-right":"position: fixed; bottom: 20px; right: 20px;","bottom-left":"position: fixed; bottom: 20px; left: 20px;","top-right":"position: fixed; top: 20px; right: 20px;","top-left":"position: fixed; top: 20px; left: 20px;"}[Chatooly.config.buttonPosition||"bottom-right"]+"\n                    z-index: 10000;\n                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;\n                "},_injectButtonCSS:function(){if(document.getElementById("chatooly-button-styles"))return;const t=document.createElement("style");t.id="chatooly-button-styles",t.textContent="\n                    #chatooly-export-btn .chatooly-btn-main {\n                        width: 50px;\n                        height: 50px;\n                        background: #007bff;\n                        border-radius: 25px;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        cursor: pointer;\n                        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);\n                        font-size: 20px;\n                        transition: all 0.2s ease;\n                        user-select: none;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-main:hover {\n                        transform: translateY(-2px);\n                        box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4);\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-main:active {\n                        transform: translateY(0);\n                        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu {\n                        position: absolute;\n                        bottom: 60px;\n                        right: 0;\n                        background: white;\n                        border-radius: 8px;\n                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n                        padding: 8px;\n                        min-width: 120px;\n                        opacity: 0;\n                        transform: translateY(10px);\n                        transition: all 0.2s ease;\n                        pointer-events: none;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu.show {\n                        opacity: 1;\n                        transform: translateY(0);\n                        pointer-events: auto;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu button {\n                        display: block;\n                        width: 100%;\n                        padding: 8px 12px;\n                        border: none;\n                        background: none;\n                        text-align: left;\n                        cursor: pointer;\n                        border-radius: 4px;\n                        margin: 2px 0;\n                        font-size: 14px;\n                        transition: background 0.1s ease;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu button:hover {\n                        background: #f8f9fa;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu button:active {\n                        background: #e9ecef;\n                    }\n                    \n                    /* Mobile responsive */\n                    @media (max-width: 768px) {\n                        #chatooly-export-btn {\n                            bottom: 10px !important;\n                            right: 10px !important;\n                        }\n                        \n                        #chatooly-export-btn .chatooly-btn-main {\n                            width: 45px;\n                            height: 45px;\n                            font-size: 18px;\n                        }\n                        \n                        #chatooly-export-btn .chatooly-btn-menu {\n                            min-width: 110px;\n                            padding: 6px;\n                        }\n                        \n                        #chatooly-export-btn .chatooly-btn-menu button {\n                            padding: 6px 10px;\n                            font-size: 13px;\n                        }\n                    }\n                ",document.head.appendChild(t)},_attachButtonEvents:function(t){const e=t.querySelector(".chatooly-btn-main"),o=t.querySelector(".chatooly-btn-menu");e.addEventListener("click",t=>{t.stopPropagation();o.classList.contains("show")?this._hideMenu(o):this._showMenu(o)}),document.addEventListener("click",e=>{t.contains(e.target)||this._hideMenu(o)}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this._hideMenu(o)})},_showMenu:function(t){t.style.display="block",t.offsetHeight,t.classList.add("show")},_hideMenu:function(t){t.classList.remove("show"),setTimeout(()=>{t.classList.contains("show")||(t.style.display="none")},200)},setTheme:function(t){console.warn("Theme support not yet implemented")},addMenuItem:function(t,e,o){const n=document.querySelector(".chatooly-btn-menu");if(!n)return;const i=document.createElement("button");i.textContent=(o?o+" ":"")+t,i.addEventListener("click",e),n.appendChild(i)},removeButton:function(){const t=document.getElementById("chatooly-export-btn"),e=document.getElementById("chatooly-button-styles");t&&t.remove(),e&&e.remove()}},document.addEventListener("DOMContentLoaded",function(){window.ChatoolyConfig?Chatooly.init(window.ChatoolyConfig):Chatooly.init()}),"loading"!==document.readyState&&setTimeout(()=>{window.ChatoolyConfig?Chatooly.init(window.ChatoolyConfig):Chatooly.init()},100)}();