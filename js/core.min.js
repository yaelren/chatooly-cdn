/**
 * Chatooly CDN - Core Library (POC Version) - Built from Modules
 * Provides PNG export functionality for canvas-based design tools
 * Supports p5.js, Three.js, and DOM-based tools
 * 
 * Built: 2025-08-07T11:33:00.355Z
 * Architecture: Modular components combined into single file
 */
!function(){"use strict";window.Chatooly={version:"1.0.0-poc",config:{},init:function(t){this.config=Object.assign({name:"Untitled Tool",exportFormats:["png"],resolution:2,buttonPosition:"bottom-right"},t),this.ui.createExportButton(),this.utils.logDevelopmentMode()},export:function(t,n){if(n=n||{},"png"!==(t=t||"png"))return void console.warn("Chatooly POC: Only PNG export supported in this version");const o=this.utils.detectExportTarget();this.pngExport.export(o,n)}},
/**
     * Chatooly CDN - Utilities Module
     * Contains utility functions for target detection, environment checks, and helpers
     */
Chatooly.utils={detectExportTarget:function(){
// 1. Look for Chatooly export container first (highest priority for HTML tools)
const t=document.querySelector("#chatooly-canvas");if(t){const n=t.querySelector("canvas");return n&&(this._isP5Canvas(n)||this._isThreeCanvas(n))?{type:"canvas",element:n}:{type:"dom",element:t}}const n=document.querySelectorAll("canvas");if(n.length>0){let t=n[0];for(let o=1;o<n.length;o++){const e=n[o];e.width*e.height>t.width*t.height&&(t=e)}return{type:"canvas",element:t}}const o=["#app","#canvas-container","main"];for(const t of o){const n=document.querySelector(t);if(n)return{type:"dom",element:n}}return{type:"dom",element:document.body}},isDevelopment:function(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname||"file:"===location.protocol},generateFilename:function(t,n){return`${t.name.toLowerCase().replace(/[^a-z0-9]/g,"-")}-export-${(new Date).toISOString().slice(0,10)}.${n||"png"}`},downloadImage:function(t,n){const o=document.createElement("a");o.download=n,o.href=t,document.body.appendChild(o),o.click(),document.body.removeChild(o)},canRerenderAtHighRes:function(t){return window.p5||window.THREE||"defaultCanvas0"===t.id},logDevelopmentMode:function(){this.isDevelopment()&&console.log("Chatooly: Development mode detected - publish functionality enabled")},_isP5Canvas:function(t){return window.p5&&("defaultCanvas0"===t.id||window.pixelDensity)},_isThreeCanvas:function(t){return window.THREE&&(window.renderer||window.threeRenderer)}},
/**
     * Chatooly CDN - HTML5 Canvas Export Module
     * Handles multiple export formats for standard HTML5 canvas elements
     */
Chatooly.canvasExporters||(Chatooly.canvasExporters={}),Chatooly.canvasExporters.html5={png:{export:function(t,n){const o=n.resolution||Chatooly.config.resolution||2,e=n.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");try{let n;if(o>1)if(window.renderHighResolution&&"function"==typeof window.renderHighResolution){const e=document.createElement("canvas");e.width=t.width*o,e.height=t.height*o,window.renderHighResolution(e,o),n=e.toDataURL("image/png")}else if(window.Chatooly&&window.Chatooly.renderHighRes&&"function"==typeof window.Chatooly.renderHighRes){
// Use Chatooly API for high-res rendering
const e=document.createElement("canvas");e.width=t.width*o,e.height=t.height*o,
// Call the Chatooly high-res render function
window.Chatooly.renderHighRes(e,o),n=e.toDataURL("image/png"),console.log("Chatooly: High-resolution export using Chatooly.renderHighRes API.")}else{const e=document.createElement("canvas"),i=e.getContext("2d");e.width=t.width*o,e.height=t.height*o,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(t,0,0,e.width,e.height),n=e.toDataURL("image/png"),console.warn("Chatooly: Using upscaling for export. For true high-resolution, implement window.renderHighResolution() or window.Chatooly.renderHighRes()")}else n=t.toDataURL("image/png");Chatooly.utils.downloadImage(n,e),console.log("Chatooly: HTML5 Canvas PNG exported at "+o+"x resolution")}catch(t){console.error("Chatooly: HTML5 Canvas PNG export failed:",t),alert("PNG export failed. This might be due to CORS restrictions.")}}},jpeg:{export:function(t,n){console.warn("JPEG export not yet implemented for HTML5 canvas")}},webm:{export:function(t,n){console.warn("WebM video export not yet implemented for HTML5 canvas")}},gif:{export:function(t,n){console.warn("GIF export not yet implemented for HTML5 canvas")}}},
/**
     * Chatooly CDN - p5.js Canvas Export Module
     * Handles multiple export formats for p5.js canvas elements
     */
Chatooly.canvasExporters||(Chatooly.canvasExporters={}),Chatooly.canvasExporters.p5={png:{export:function(t,n){const o=n.resolution||Chatooly.config.resolution||2,e=n.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");try{let n;if(o>1&&window.p5&&window.pixelDensity){const e=window.pixelDensity();window.pixelDensity(o),window.redraw(),n=t.toDataURL("image/png"),window.pixelDensity(e)}else n=t.toDataURL("image/png");Chatooly.utils.downloadImage(n,e),console.log("Chatooly: p5.js Canvas PNG exported at "+o+"x resolution")}catch(t){console.error("Chatooly: p5.js Canvas PNG export failed:",t),alert("PNG export failed. This might be due to CORS restrictions.")}}},webm:{export:function(t,n){console.warn("WebM video export not yet implemented for p5.js canvas")}},gif:{export:function(t,n){console.warn("GIF export not yet implemented for p5.js canvas")}},frames:{export:function(t,n){console.warn("Frame sequence export not yet implemented for p5.js canvas")}}},
/**
     * Chatooly CDN - Three.js Canvas Export Module
     * Handles multiple export formats for Three.js canvas elements
     */
Chatooly.canvasExporters||(Chatooly.canvasExporters={}),Chatooly.canvasExporters.three={png:{export:function(t,n){const o=n.resolution||Chatooly.config.resolution||2,e=n.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");try{let n;n=o>1&&window.THREE&&(window.renderer||window.threeRenderer)?this._renderHighRes(t,o):t.toDataURL("image/png"),Chatooly.utils.downloadImage(n,e),console.log("Chatooly: Three.js Canvas PNG exported at "+o+"x resolution")}catch(t){console.error("Chatooly: Three.js Canvas PNG export failed:",t),alert("PNG export failed. This might be due to CORS restrictions.")}},_renderHighRes:function(t,n){const o=window.renderer||window.threeRenderer,e=window.scene||window.threeScene,i=window.camera||window.threeCamera;if(o&&e&&i){const t=o.getSize(new THREE.Vector2),r=document.createElement("canvas"),a=new THREE.WebGLRenderer({canvas:r,antialias:!0,preserveDrawingBuffer:!0});a.setSize(t.x*n,t.y*n,!1),a.setClearColor(o.getClearColor(),o.getClearAlpha()),a.render(e,i);const s=r.toDataURL("image/png");return a.dispose(),s}return this._fallbackScale(t,n)},_fallbackScale:function(t,n){const o=document.createElement("canvas"),e=o.getContext("2d");return o.width=t.width*n,o.height=t.height*n,e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.drawImage(t,0,0,o.width,o.height),o.toDataURL("image/png")}},panorama:{export:function(t,n){console.warn("360Â° panorama export not yet implemented for Three.js canvas")}},webm:{export:function(t,n){console.warn("WebM video export not yet implemented for Three.js canvas")}},glb:{export:function(t,n){console.warn("GLB model export not yet implemented for Three.js")}}},
/**
     * Chatooly CDN - DOM Export Module
     * Handles multiple export formats for DOM elements using html2canvas
     */
Chatooly.domExport={export:function(t,n){const o=n.format||"png";this[o]?this[o].export(t,n):console.warn(`Chatooly: DOM export format '${o}' not supported`)},png:{export:function(t,n){const o=n.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");"undefined"==typeof html2canvas?Chatooly.domExport._loadHtml2Canvas().then(()=>{Chatooly.domExport.png._captureDOM(t,o,n)}).catch(t=>{console.error("Chatooly: Failed to load html2canvas:",t),alert("PNG export failed: Could not load required library")}):this._captureDOM(t,o,n)},_captureDOM:function(t,n,o){const e=o.resolution||Chatooly.config.resolution||2;html2canvas(t,{scale:e,useCORS:!0,allowTaint:!1,backgroundColor:o.backgroundColor||null,width:o.width,height:o.height,scrollX:0,scrollY:0}).then(t=>{const o=t.toDataURL("image/png");Chatooly.utils.downloadImage(o,n),console.log("Chatooly: DOM PNG exported successfully at "+e+"x resolution")}).catch(t=>{console.error("Chatooly: DOM PNG export failed:",t),alert("PNG export failed. Try exporting a specific element.")})}},jpeg:{export:function(t,n){console.warn("JPEG export not yet implemented for DOM elements")}},pdf:{export:function(t,n){console.warn("PDF export not yet implemented for DOM elements")}},svg:{export:function(t,n){console.warn("SVG export not yet implemented for DOM elements")}},_loadHtml2Canvas:function(){return this._html2canvasPromise||(this._html2canvasPromise=new Promise((t,n)=>{const o=["https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js","https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js","https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"],e=i=>{if(i>=o.length)return void n(new Error("All CDN sources failed"));const r=document.createElement("script");r.src=o[i],r.async=!0,r.crossOrigin="anonymous";const a=()=>{document.head.removeChild(r)};r.onload=()=>{a(),t()},r.onerror=()=>{a(),console.warn(`Chatooly: Failed to load html2canvas from ${o[i]}`),e(i+1)},setTimeout(()=>{window.html2canvas||(a(),e(i+1))},1e4),document.head.appendChild(r)};e(0)})),this._html2canvasPromise}},
/**
     * Chatooly CDN - PNG Export Module
     * Main PNG export orchestrator that delegates to specific export handlers
     */
Chatooly.pngExport={export:function(t,n){"canvas"===t.type?this._exportCanvas(t.element,n):this._exportDOM(t.element,n)},_exportCanvas:function(t,n){this._isP5Canvas(t)?Chatooly.canvasExporters.p5.png.export(t,n):this._isThreeCanvas(t)?Chatooly.canvasExporters.three.png.export(t,n):Chatooly.canvasExporters.html5.png.export(t,n)},_exportDOM:function(t,n){Chatooly.domExport.export(t,n)},_isP5Canvas:function(t){return window.p5&&("defaultCanvas0"===t.id||window.pixelDensity)},_isThreeCanvas:function(t){return window.THREE&&(window.renderer||window.threeRenderer)}},
/**
     * Chatooly CDN - Publishing Module
     * Handles tool publishing functionality for development mode
     */
Chatooly.publish={publish:function(t){if(!Chatooly.utils.isDevelopment())return void console.warn("Chatooly: Publishing only available in development mode");const n=(t=t||{}).name||Chatooly.config.name||prompt("Enter tool name for publishing:");if(!n)return void console.log("Chatooly: Publishing cancelled");const o=this._loadToolConfig(t),e=this._createToolSlug(n);console.log('Chatooly: Publishing tool "'+n+'" as "'+e+'"');const i=this.validateTool();if(!i.valid)return console.error("Chatooly: Tool validation failed:",i.errors),void alert("Publishing failed. Please fix these errors:\n"+i.errors.join("\n"));i.warnings.length>0&&console.warn("Chatooly: Publishing warnings:",i.warnings);const r=this._gatherToolFiles(),a={name:n,slug:e,category:o.category||"uncategorized",tags:o.tags||[],description:o.description||"",private:o.private||!1,version:o.version||"1.0.0",author:o.author||"Anonymous",timestamp:(new Date).toISOString()};this._showPublishingProgress(),this._uploadToStaging(e,r,a).then(t=>{this._hidePublishingProgress(),this._showPublishSuccess(t)}).catch(t=>{this._hidePublishingProgress(),this._showPublishError(t)})},_createToolSlug:function(t){return t.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")},_gatherToolFiles:function(){const t={},n=document.documentElement.cloneNode(!0),o=n.querySelector("#chatooly-export-btn");
// Get current HTML (remove Chatooly button for published version)
o&&o.remove(),t["index.html"]="<!DOCTYPE html>"+n.outerHTML;const e=Array.from(document.querySelectorAll("style")).map(t=>t.textContent).join("\n");e&&(t["style.css"]=e);const i=Array.from(document.querySelectorAll("script:not([src])")).map(t=>t.textContent).join("\n");return i&&(t["tool.js"]=i),t.resources=this._gatherResourceReferences(),t},_gatherResourceReferences:function(){const t={scripts:[],styles:[],images:[],fonts:[]};return Array.from(document.querySelectorAll("script[src]")).forEach(n=>{t.scripts.push(n.src)}),Array.from(document.querySelectorAll('link[rel="stylesheet"]')).forEach(n=>{t.styles.push(n.href)}),Array.from(document.querySelectorAll("img[src]")).forEach(n=>{t.images.push(n.src)}),t},_loadToolConfig:function(t){
// Try to load from global ChatoolyConfig or passed options
const n=window.ChatoolyConfig||{};return Object.assign({category:"tools",tags:[],description:"",private:!1,version:"1.0.0",author:"Anonymous"},n,t)},_uploadToStaging:function(t,n,o){return new Promise((n,e)=>{try{console.log("Chatooly: Uploading to staging..."),
//         'X-Chatooly-Auth': this._getAuthToken()
setTimeout(()=>{const e={success:!0,stagingUrl:`https://tools.chatooly.com/staging/${t}`,productionUrl:`https://tools.chatooly.com/${t}`,publishedAt:(new Date).toISOString(),metadata:o};localStorage.setItem(`chatooly-published-${t}`,JSON.stringify(e)),n(e)},2e3)}catch(t){e(t)}})},_showPublishingProgress:function(){const t=document.createElement("div");t.id="chatooly-publish-progress",t.innerHTML='\n                    <div style="\n                        position: fixed;\n                        top: 50%;\n                        left: 50%;\n                        transform: translate(-50%, -50%);\n                        background: white;\n                        padding: 30px;\n                        border-radius: 12px;\n                        box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n                        z-index: 100000;\n                        text-align: center;\n                        font-family: -apple-system, system-ui, sans-serif;\n                    ">\n                        <div style="\n                            width: 50px;\n                            height: 50px;\n                            border: 3px solid #f3f3f3;\n                            border-top: 3px solid #007bff;\n                            border-radius: 50%;\n                            margin: 0 auto 20px;\n                            animation: chatooly-spin 1s linear infinite;\n                        "></div>\n                        <h3 style="margin: 0 0 10px;">Publishing to Chatooly...</h3>\n                        <p style="margin: 0; color: #666;">Uploading tool files to staging server</p>\n                    </div>\n                    <style>\n                        @keyframes chatooly-spin {\n                            0% { transform: rotate(0deg); }\n                            100% { transform: rotate(360deg); }\n                        }\n                    </style>\n                ',document.body.appendChild(t)},_hidePublishingProgress:function(){const t=document.getElementById("chatooly-publish-progress");t&&t.remove()},_showPublishSuccess:function(t){const n=document.createElement("div");n.innerHTML=`\n                    <div style="\n                        position: fixed;\n                        top: 50%;\n                        left: 50%;\n                        transform: translate(-50%, -50%);\n                        background: white;\n                        padding: 30px;\n                        border-radius: 12px;\n                        box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n                        z-index: 100000;\n                        text-align: center;\n                        font-family: -apple-system, system-ui, sans-serif;\n                        max-width: 500px;\n                    ">\n                        <div style="\n                            width: 60px;\n                            height: 60px;\n                            background: #28a745;\n                            border-radius: 50%;\n                            margin: 0 auto 20px;\n                            display: flex;\n                            align-items: center;\n                            justify-content: center;\n                            color: white;\n                            font-size: 30px;\n                        ">â</div>\n                        <h3 style="margin: 0 0 10px; color: #28a745;">Published Successfully!</h3>\n                        <p style="margin: 10px 0; color: #666;">\n                            Your tool has been uploaded to staging for review.\n                        </p>\n                        <div style="\n                            background: #f8f9fa;\n                            padding: 15px;\n                            border-radius: 8px;\n                            margin: 20px 0;\n                            text-align: left;\n                        ">\n                            <p style="margin: 5px 0;"><strong>Staging URL:</strong><br>\n                                <a href="${t.stagingUrl}" target="_blank" style="color: #007bff;">\n                                    ${t.stagingUrl}\n                                </a>\n                            </p>\n                            <p style="margin: 5px 0;"><strong>Production URL:</strong><br>\n                                <span style="color: #666;">${t.productionUrl}</span>\n                                <br><small>(Available after admin approval)</small>\n                            </p>\n                        </div>\n                        <button onclick="this.closest('div').parentElement.remove()" style="\n                            background: #007bff;\n                            color: white;\n                            border: none;\n                            padding: 10px 30px;\n                            border-radius: 6px;\n                            font-size: 16px;\n                            cursor: pointer;\n                        ">Close</button>\n                    </div>\n                `,document.body.appendChild(n)},_showPublishError:function(t){const n=document.createElement("div");n.innerHTML=`\n                    <div style="\n                        position: fixed;\n                        top: 50%;\n                        left: 50%;\n                        transform: translate(-50%, -50%);\n                        background: white;\n                        padding: 30px;\n                        border-radius: 12px;\n                        box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n                        z-index: 100000;\n                        text-align: center;\n                        font-family: -apple-system, system-ui, sans-serif;\n                        max-width: 500px;\n                    ">\n                        <div style="\n                            width: 60px;\n                            height: 60px;\n                            background: #dc3545;\n                            border-radius: 50%;\n                            margin: 0 auto 20px;\n                            display: flex;\n                            align-items: center;\n                            justify-content: center;\n                            color: white;\n                            font-size: 30px;\n                        ">â</div>\n                        <h3 style="margin: 0 0 10px; color: #dc3545;">Publishing Failed</h3>\n                        <p style="margin: 10px 0; color: #666;">\n                            ${t.message||"An error occurred while publishing your tool."}\n                        </p>\n                        <button onclick="this.closest('div').parentElement.remove()" style="\n                            background: #dc3545;\n                            color: white;\n                            border: none;\n                            padding: 10px 30px;\n                            border-radius: 6px;\n                            font-size: 16px;\n                            cursor: pointer;\n                        ">Close</button>\n                    </div>\n                `,document.body.appendChild(n)},validateTool:function(){const t={valid:!0,warnings:[],errors:[]};Chatooly.config.name&&"Untitled Tool"!==Chatooly.config.name||t.warnings.push("Tool name not set - using default");Chatooly.utils.detectExportTarget().element||(t.errors.push("No exportable content found"),t.valid=!1);return 0===document.querySelectorAll("script[src]").length&&t.warnings.push("No external libraries detected"),t},publishFromCLI:function(t){try{const t=window.ChatoolyPublishConfig||{name:Chatooly.config.name,category:"tools",tags:[],description:"",version:"1.0.0"};if(!t.name)throw new Error("Tool name is required in config");this.publish(t)}catch(t){console.error("Chatooly CLI: Publishing failed:",t),"undefined"!=typeof process&&process.exit&&process.exit(1)}},_getAuthToken:function(){return"poc-auth-token"}},
/**
     * Chatooly CDN - UI Module
     * Handles user interface components like export button and menus
     */
Chatooly.ui={createExportButton:function(){const t=document.getElementById("chatooly-export-btn");t&&t.remove();const n=document.createElement("div");n.id="chatooly-export-btn",n.innerHTML=this._getButtonHTML(),n.style.cssText=this._getButtonStyles(),this._injectButtonCSS(),this._attachButtonEvents(n),document.body.appendChild(n)},_getButtonHTML:function(){return`\n                    <div class="chatooly-btn-main">ð¥</div>\n                    <div class="chatooly-btn-menu" style="display: none;">\n                        <button onclick="Chatooly.export('png', {resolution: 1})">1x PNG</button>\n                        <button onclick="Chatooly.export('png', {resolution: 2})">2x PNG</button>\n                        <button onclick="Chatooly.export('png', {resolution: 4})">4x PNG</button>\n                        ${Chatooly.utils.isDevelopment()?'<button onclick="Chatooly.publish.publish()">ð¤ Publish</button>':""}\n                    </div>\n                `},_getButtonStyles:function(){return{"bottom-right":"position: fixed; bottom: 20px; right: 20px;","bottom-left":"position: fixed; bottom: 20px; left: 20px;","top-right":"position: fixed; top: 20px; right: 20px;","top-left":"position: fixed; top: 20px; left: 20px;"}[Chatooly.config.buttonPosition||"bottom-right"]+"\n                    z-index: 10000;\n                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;\n                "},_injectButtonCSS:function(){if(document.getElementById("chatooly-button-styles"))return;const t=document.createElement("style");t.id="chatooly-button-styles",t.textContent="\n                    #chatooly-export-btn .chatooly-btn-main {\n                        width: 50px;\n                        height: 50px;\n                        background: #007bff;\n                        border-radius: 25px;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        cursor: pointer;\n                        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);\n                        font-size: 20px;\n                        transition: all 0.2s ease;\n                        user-select: none;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-main:hover {\n                        transform: translateY(-2px);\n                        box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4);\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-main:active {\n                        transform: translateY(0);\n                        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu {\n                        position: absolute;\n                        bottom: 60px;\n                        right: 0;\n                        background: white;\n                        border-radius: 8px;\n                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n                        padding: 8px;\n                        min-width: 120px;\n                        opacity: 0;\n                        transform: translateY(10px);\n                        transition: all 0.2s ease;\n                        pointer-events: none;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu.show {\n                        opacity: 1;\n                        transform: translateY(0);\n                        pointer-events: auto;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu button {\n                        display: block;\n                        width: 100%;\n                        padding: 8px 12px;\n                        border: none;\n                        background: none;\n                        text-align: left;\n                        cursor: pointer;\n                        border-radius: 4px;\n                        margin: 2px 0;\n                        font-size: 14px;\n                        transition: background 0.1s ease;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu button:hover {\n                        background: #f8f9fa;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu button:active {\n                        background: #e9ecef;\n                    }\n                    \n                    /* Mobile responsive */\n                    @media (max-width: 768px) {\n                        #chatooly-export-btn {\n                            bottom: 10px !important;\n                            right: 10px !important;\n                        }\n                        \n                        #chatooly-export-btn .chatooly-btn-main {\n                            width: 45px;\n                            height: 45px;\n                            font-size: 18px;\n                        }\n                        \n                        #chatooly-export-btn .chatooly-btn-menu {\n                            min-width: 110px;\n                            padding: 6px;\n                        }\n                        \n                        #chatooly-export-btn .chatooly-btn-menu button {\n                            padding: 6px 10px;\n                            font-size: 13px;\n                        }\n                    }\n                ",document.head.appendChild(t)},_attachButtonEvents:function(t){const n=t.querySelector(".chatooly-btn-main"),o=t.querySelector(".chatooly-btn-menu");n.addEventListener("click",t=>{t.stopPropagation();o.classList.contains("show")?this._hideMenu(o):this._showMenu(o)}),document.addEventListener("click",n=>{t.contains(n.target)||this._hideMenu(o)}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this._hideMenu(o)})},_showMenu:function(t){t.style.display="block",t.offsetHeight,t.classList.add("show")},_hideMenu:function(t){t.classList.remove("show"),setTimeout(()=>{t.classList.contains("show")||(t.style.display="none")},200)},setTheme:function(t){console.warn("Theme support not yet implemented")},addMenuItem:function(t,n,o){const e=document.querySelector(".chatooly-btn-menu");if(!e)return;const i=document.createElement("button");i.textContent=(o?o+" ":"")+t,i.addEventListener("click",n),e.appendChild(i)},removeButton:function(){const t=document.getElementById("chatooly-export-btn"),n=document.getElementById("chatooly-button-styles");t&&t.remove(),n&&n.remove()}},document.addEventListener("DOMContentLoaded",function(){window.ChatoolyConfig?Chatooly.init(window.ChatoolyConfig):Chatooly.init()}),"loading"!==document.readyState&&setTimeout(()=>{window.ChatoolyConfig?Chatooly.init(window.ChatoolyConfig):Chatooly.init()},100)}();