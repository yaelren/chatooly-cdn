/**
 * Chatooly CDN - Core Library (POC Version) - Built from Modules
 * Provides PNG export functionality for canvas-based design tools
 * Supports p5.js, Three.js, and DOM-based tools
 * 
 * Built: 2025-08-04T16:57:29.801Z
 * Architecture: Modular components combined into single file
 */
!function(){"use strict";window.Chatooly={version:"1.0.0-poc",config:{},init:function(t){this.config=Object.assign({name:"Untitled Tool",exportFormats:["png"],resolution:2,buttonPosition:"bottom-right"},t),this.ui.createExportButton(),this.utils.logDevelopmentMode()},export:function(t,o){if(o=o||{},"png"!==(t=t||"png"))return void console.warn("Chatooly POC: Only PNG export supported in this version");const e=this.utils.detectExportTarget();this.pngExport.export(e,o)}},
/**
     * Chatooly CDN - Utilities Module
     * Contains utility functions for target detection, environment checks, and helpers
     */
Chatooly.utils={detectExportTarget:function(){const t=document.querySelectorAll("canvas");if(t.length>0){let o=t[0];for(let e=1;e<t.length;e++){const n=t[e];n.width*n.height>o.width*o.height&&(o=n)}return{type:"canvas",element:o}}const o=["#gradient-display","#preview",".export-area"];for(const t of o){const o=document.querySelector(t);if(o)return{type:"dom",element:o}}const e=["#app","#canvas-container","main"];for(const t of e){const o=document.querySelector(t);if(o)return{type:"dom",element:o}}return{type:"dom",element:document.body}},isDevelopment:function(){return"localhost"===location.hostname||"127.0.0.1"===location.hostname||"file:"===location.protocol},generateFilename:function(t,o){return`${t.name.toLowerCase().replace(/[^a-z0-9]/g,"-")}-export-${(new Date).toISOString().slice(0,10)}.${o||"png"}`},downloadImage:function(t,o){const e=document.createElement("a");e.download=o,e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)},canRerenderAtHighRes:function(t){return window.p5||window.THREE||"defaultCanvas0"===t.id},logDevelopmentMode:function(){this.isDevelopment()&&console.log("Chatooly: Development mode detected - publish functionality enabled")}},
/**
     * Chatooly CDN - HTML5 Canvas Export Module
     * Handles multiple export formats for standard HTML5 canvas elements
     */
Chatooly.canvasExporters||(Chatooly.canvasExporters={}),Chatooly.canvasExporters.html5={png:{export:function(t,o){const e=o.resolution||Chatooly.config.resolution||2,n=o.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");try{let o;if(e>1){const n=document.createElement("canvas"),a=n.getContext("2d");n.width=t.width*e,n.height=t.height*e,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(t,0,0,n.width,n.height),o=n.toDataURL("image/png")}else o=t.toDataURL("image/png");Chatooly.utils.downloadImage(o,n),console.log("Chatooly: HTML5 Canvas PNG exported at "+e+"x resolution")}catch(t){console.error("Chatooly: HTML5 Canvas PNG export failed:",t),alert("PNG export failed. This might be due to CORS restrictions.")}}},jpeg:{export:function(t,o){console.warn("JPEG export not yet implemented for HTML5 canvas")}},webm:{export:function(t,o){console.warn("WebM video export not yet implemented for HTML5 canvas")}},gif:{export:function(t,o){console.warn("GIF export not yet implemented for HTML5 canvas")}}},
/**
     * Chatooly CDN - p5.js Canvas Export Module
     * Handles multiple export formats for p5.js canvas elements
     */
Chatooly.canvasExporters||(Chatooly.canvasExporters={}),Chatooly.canvasExporters.p5={png:{export:function(t,o){const e=o.resolution||Chatooly.config.resolution||2,n=o.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");try{let o;if(e>1&&window.p5&&window.pixelDensity){const n=window.pixelDensity();window.pixelDensity(e),window.redraw(),o=t.toDataURL("image/png"),window.pixelDensity(n)}else o=t.toDataURL("image/png");Chatooly.utils.downloadImage(o,n),console.log("Chatooly: p5.js Canvas PNG exported at "+e+"x resolution")}catch(t){console.error("Chatooly: p5.js Canvas PNG export failed:",t),alert("PNG export failed. This might be due to CORS restrictions.")}}},webm:{export:function(t,o){console.warn("WebM video export not yet implemented for p5.js canvas")}},gif:{export:function(t,o){console.warn("GIF export not yet implemented for p5.js canvas")}},frames:{export:function(t,o){console.warn("Frame sequence export not yet implemented for p5.js canvas")}}},
/**
     * Chatooly CDN - Three.js Canvas Export Module
     * Handles multiple export formats for Three.js canvas elements
     */
Chatooly.canvasExporters||(Chatooly.canvasExporters={}),Chatooly.canvasExporters.three={png:{export:function(t,o){const e=o.resolution||Chatooly.config.resolution||2,n=o.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");try{let o;o=e>1&&window.THREE&&(window.renderer||window.threeRenderer)?this._renderHighRes(t,e):t.toDataURL("image/png"),Chatooly.utils.downloadImage(o,n),console.log("Chatooly: Three.js Canvas PNG exported at "+e+"x resolution")}catch(t){console.error("Chatooly: Three.js Canvas PNG export failed:",t),alert("PNG export failed. This might be due to CORS restrictions.")}},_renderHighRes:function(t,o){const e=window.renderer||window.threeRenderer,n=window.scene||window.threeScene,a=window.camera||window.threeCamera;if(e&&n&&a){const t=e.getSize(new THREE.Vector2),i=document.createElement("canvas"),r=new THREE.WebGLRenderer({canvas:i,antialias:!0,preserveDrawingBuffer:!0});r.setSize(t.x*o,t.y*o,!1),r.setClearColor(e.getClearColor(),e.getClearAlpha()),r.render(n,a);const l=i.toDataURL("image/png");return r.dispose(),l}return this._fallbackScale(t,o)},_fallbackScale:function(t,o){const e=document.createElement("canvas"),n=e.getContext("2d");return e.width=t.width*o,e.height=t.height*o,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(t,0,0,e.width,e.height),e.toDataURL("image/png")}},panorama:{export:function(t,o){console.warn("360Â° panorama export not yet implemented for Three.js canvas")}},webm:{export:function(t,o){console.warn("WebM video export not yet implemented for Three.js canvas")}},glb:{export:function(t,o){console.warn("GLB model export not yet implemented for Three.js")}}},
/**
     * Chatooly CDN - DOM Export Module
     * Handles multiple export formats for DOM elements using html2canvas
     */
Chatooly.domExport={export:function(t,o){const e=o.format||"png";this[e]?this[e].export(t,o):console.warn(`Chatooly: DOM export format '${e}' not supported`)},png:{export:function(t,o){const e=o.filename||Chatooly.utils.generateFilename(Chatooly.config,"png");"undefined"==typeof html2canvas?Chatooly.domExport._loadHtml2Canvas().then(()=>{Chatooly.domExport.png._captureDOM(t,e,o)}).catch(t=>{console.error("Chatooly: Failed to load html2canvas:",t),alert("PNG export failed: Could not load required library")}):this._captureDOM(t,e,o)},_captureDOM:function(t,o,e){const n=e.resolution||Chatooly.config.resolution||2;html2canvas(t,{scale:n,useCORS:!0,allowTaint:!1,backgroundColor:e.backgroundColor||null,width:e.width,height:e.height,scrollX:0,scrollY:0}).then(t=>{const e=t.toDataURL("image/png");Chatooly.utils.downloadImage(e,o),console.log("Chatooly: DOM PNG exported successfully at "+n+"x resolution")}).catch(t=>{console.error("Chatooly: DOM PNG export failed:",t),alert("PNG export failed. Try exporting a specific element.")})}},jpeg:{export:function(t,o){console.warn("JPEG export not yet implemented for DOM elements")}},pdf:{export:function(t,o){console.warn("PDF export not yet implemented for DOM elements")}},svg:{export:function(t,o){console.warn("SVG export not yet implemented for DOM elements")}},_loadHtml2Canvas:function(){return this._html2canvasPromise||(this._html2canvasPromise=new Promise((t,o)=>{const e=["https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js","https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js","https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"],n=a=>{if(a>=e.length)return void o(new Error("All CDN sources failed"));const i=document.createElement("script");i.src=e[a],i.async=!0,i.crossOrigin="anonymous";const r=()=>{document.head.removeChild(i)};i.onload=()=>{r(),t()},i.onerror=()=>{r(),console.warn(`Chatooly: Failed to load html2canvas from ${e[a]}`),n(a+1)},setTimeout(()=>{window.html2canvas||(r(),n(a+1))},1e4),document.head.appendChild(i)};n(0)})),this._html2canvasPromise}},
/**
     * Chatooly CDN - PNG Export Module
     * Main PNG export orchestrator that delegates to specific export handlers
     */
Chatooly.pngExport={export:function(t,o){"canvas"===t.type?this._exportCanvas(t.element,o):this._exportDOM(t.element,o)},_exportCanvas:function(t,o){this._isP5Canvas(t)?Chatooly.canvasExporters.p5.png.export(t,o):this._isThreeCanvas(t)?Chatooly.canvasExporters.three.png.export(t,o):Chatooly.canvasExporters.html5.png.export(t,o)},_exportDOM:function(t,o){Chatooly.domExport.export(t,o)},_isP5Canvas:function(t){return window.p5&&("defaultCanvas0"===t.id||window.pixelDensity)},_isThreeCanvas:function(t){return window.THREE&&(window.renderer||window.threeRenderer)}},
/**
     * Chatooly CDN - Publishing Module
     * Handles tool publishing functionality for development mode
     */
Chatooly.publish={publish:function(t){if(!Chatooly.utils.isDevelopment())return void console.warn("Chatooly: Publishing only available in development mode");const o=(t=t||{}).name||Chatooly.config.name||prompt("Enter tool name for publishing:");if(!o)return void console.log("Chatooly: Publishing cancelled");const e=this._createToolSlug(o);console.log('Chatooly: Publishing tool "'+o+'" as "'+e+'"'),"function"==typeof window.publishTool?window.publishTool(e,this._gatherToolFiles()):this._showPublishInstructions(e)},_createToolSlug:function(t){return t.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")},_gatherToolFiles:function(){const t={},o=document.documentElement.cloneNode(!0),e=o.querySelector("#chatooly-export-btn");
// Get current HTML (remove Chatooly button for published version)
e&&e.remove(),t["index.html"]="<!DOCTYPE html>"+o.outerHTML;const n=Array.from(document.querySelectorAll("style")).map(t=>t.textContent).join("\n");n&&(t["style.css"]=n);const a=Array.from(document.querySelectorAll("script:not([src])")).map(t=>t.textContent).join("\n");return a&&(t["tool.js"]=a),t.resources=this._gatherResourceReferences(),t},_gatherResourceReferences:function(){const t={scripts:[],styles:[],images:[],fonts:[]};return Array.from(document.querySelectorAll("script[src]")).forEach(o=>{t.scripts.push(o.src)}),Array.from(document.querySelectorAll('link[rel="stylesheet"]')).forEach(o=>{t.styles.push(o.href)}),Array.from(document.querySelectorAll("img[src]")).forEach(o=>{t.images.push(o.src)}),t},_showPublishInstructions:function(t){const o=`\n    Publishing "${t}":\n    \n    1. Run: npm run publish\n       (This will call .chatooly/publish.js script)\n    \n    2. Or manually upload to staging:\n       - Tool will be available at: tools.chatooly.com/staging/${t}\n       - Admin can promote to: tools.chatooly.com/${t}\n    \n    3. Required files:\n       - index.html (main tool file)\n       - style.css (if using external styles)  \n       - tool.js (if using external scripts)\n    \n    4. Publishing options:\n       - Static hosting (Vercel, Netlify, GitHub Pages)\n       - Chatooly Hub API integration\n       - Custom deployment pipeline\n    \n    See template documentation for setup details.\n                `.trim();alert(o),console.log("Chatooly:",o)},validateTool:function(){const t={valid:!0,warnings:[],errors:[]};Chatooly.config.name&&"Untitled Tool"!==Chatooly.config.name||t.warnings.push("Tool name not set - using default");Chatooly.utils.detectExportTarget().element||(t.errors.push("No exportable content found"),t.valid=!1);return 0===document.querySelectorAll("script[src]").length&&t.warnings.push("No external libraries detected"),t}},
/**
     * Chatooly CDN - UI Module
     * Handles user interface components like export button and menus
     */
Chatooly.ui={createExportButton:function(){const t=document.getElementById("chatooly-export-btn");t&&t.remove();const o=document.createElement("div");o.id="chatooly-export-btn",o.innerHTML=this._getButtonHTML(),o.style.cssText=this._getButtonStyles(),this._injectButtonCSS(),this._attachButtonEvents(o),document.body.appendChild(o)},_getButtonHTML:function(){return`\n                    <div class="chatooly-btn-main">ðŸ“¥</div>\n                    <div class="chatooly-btn-menu" style="display: none;">\n                        <button onclick="Chatooly.export('png', {resolution: 1})">1x PNG</button>\n                        <button onclick="Chatooly.export('png', {resolution: 2})">2x PNG</button>\n                        <button onclick="Chatooly.export('png', {resolution: 4})">4x PNG</button>\n                        ${Chatooly.utils.isDevelopment()?'<button onclick="Chatooly.publish.publish()">ðŸ“¤ Publish</button>':""}\n                    </div>\n                `},_getButtonStyles:function(){return{"bottom-right":"position: fixed; bottom: 20px; right: 20px;","bottom-left":"position: fixed; bottom: 20px; left: 20px;","top-right":"position: fixed; top: 20px; right: 20px;","top-left":"position: fixed; top: 20px; left: 20px;"}[Chatooly.config.buttonPosition||"bottom-right"]+"\n                    z-index: 10000;\n                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;\n                "},_injectButtonCSS:function(){if(document.getElementById("chatooly-button-styles"))return;const t=document.createElement("style");t.id="chatooly-button-styles",t.textContent="\n                    #chatooly-export-btn .chatooly-btn-main {\n                        width: 50px;\n                        height: 50px;\n                        background: #007bff;\n                        border-radius: 25px;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        cursor: pointer;\n                        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);\n                        font-size: 20px;\n                        transition: all 0.2s ease;\n                        user-select: none;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-main:hover {\n                        transform: translateY(-2px);\n                        box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4);\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-main:active {\n                        transform: translateY(0);\n                        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu {\n                        position: absolute;\n                        bottom: 60px;\n                        right: 0;\n                        background: white;\n                        border-radius: 8px;\n                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n                        padding: 8px;\n                        min-width: 120px;\n                        opacity: 0;\n                        transform: translateY(10px);\n                        transition: all 0.2s ease;\n                        pointer-events: none;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu.show {\n                        opacity: 1;\n                        transform: translateY(0);\n                        pointer-events: auto;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu button {\n                        display: block;\n                        width: 100%;\n                        padding: 8px 12px;\n                        border: none;\n                        background: none;\n                        text-align: left;\n                        cursor: pointer;\n                        border-radius: 4px;\n                        margin: 2px 0;\n                        font-size: 14px;\n                        transition: background 0.1s ease;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu button:hover {\n                        background: #f8f9fa;\n                    }\n                    \n                    #chatooly-export-btn .chatooly-btn-menu button:active {\n                        background: #e9ecef;\n                    }\n                    \n                    /* Mobile responsive */\n                    @media (max-width: 768px) {\n                        #chatooly-export-btn {\n                            bottom: 10px !important;\n                            right: 10px !important;\n                        }\n                        \n                        #chatooly-export-btn .chatooly-btn-main {\n                            width: 45px;\n                            height: 45px;\n                            font-size: 18px;\n                        }\n                        \n                        #chatooly-export-btn .chatooly-btn-menu {\n                            min-width: 110px;\n                            padding: 6px;\n                        }\n                        \n                        #chatooly-export-btn .chatooly-btn-menu button {\n                            padding: 6px 10px;\n                            font-size: 13px;\n                        }\n                    }\n                ",document.head.appendChild(t)},_attachButtonEvents:function(t){const o=t.querySelector(".chatooly-btn-main"),e=t.querySelector(".chatooly-btn-menu");o.addEventListener("click",t=>{t.stopPropagation();e.classList.contains("show")?this._hideMenu(e):this._showMenu(e)}),document.addEventListener("click",o=>{t.contains(o.target)||this._hideMenu(e)}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this._hideMenu(e)})},_showMenu:function(t){t.style.display="block",t.offsetHeight,t.classList.add("show")},_hideMenu:function(t){t.classList.remove("show"),setTimeout(()=>{t.classList.contains("show")||(t.style.display="none")},200)},setTheme:function(t){console.warn("Theme support not yet implemented")},addMenuItem:function(t,o,e){const n=document.querySelector(".chatooly-btn-menu");if(!n)return;const a=document.createElement("button");a.textContent=(e?e+" ":"")+t,a.addEventListener("click",o),n.appendChild(a)},removeButton:function(){const t=document.getElementById("chatooly-export-btn"),o=document.getElementById("chatooly-button-styles");t&&t.remove(),o&&o.remove()}},document.addEventListener("DOMContentLoaded",function(){window.ChatoolyConfig?Chatooly.init(window.ChatoolyConfig):Chatooly.init()}),"loading"!==document.readyState&&setTimeout(()=>{window.ChatoolyConfig?Chatooly.init(window.ChatoolyConfig):Chatooly.init()},100)}();